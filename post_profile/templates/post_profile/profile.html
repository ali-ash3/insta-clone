{% include 'post_profile/navbar.html' %}

{% comment %} {% block content %}
    <div class="profile">
        <h1>Username: {{ user.username }}</h1>

        {% if profile_details.profile_picture %}
            <img src="{{ profile_details.profile_picture.url }}" alt="Profile Picture" width="10%" style="border-radius: 50%;">
        {% else %}
            <p>No profile picture available</p>
        {% endif %}

        {% if profile_details.bio %}
            <p>Bio: {{ profile_details.bio }}</p>
        {% elif request.user == user %}
            <p>No bio yet <a href="{% url "post_profile:edit_profile_details" user.id %}">Add Bio</a></p>
        {% else %}
            <p>No bio yet</p>
        {% endif %}

        {% if user != user_profile.user %}
            <div id="follow-button">
                <button id="toggle-follow" data-user-id="{{ user.id }}">
                    {% if user_profile in user.followers.all %}
                        Unfollow
                    {% else %}
                        Follow
                    {% endif %}
                </button>
            </div>
            <p id="follower-count">Followers: {{ user.followers.count }}</p>
        {% endif %}

        <h2>Posts:</h2>
        {% if user.photo_set.all %}
            <ul>
                {% for photo in user.photo_set.all %}
                    <li>
                        <img src="{{ photo.image.url }}" alt="User Post" width="100" height="100">
                        <p>Caption: {{ photo.caption }}</p>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No posts yet.</p>
        {% endif %}
    </div>
    <p>Go To <a href="{% url "accounts:index" %}">Index</a></p>

    {% if request.user == user %}
        <p><a href="{% url "post_profile:edit_profile_details" user.id %}">Edit details</a></p>
        <p><a href="{% url "post_profile:upload_photo" %}">Create Post</a></p>
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#toggle-follow').click(function () {
                var userId = $(this).data('user-id');
                $.ajax({
                    url: '{% url "post_profile:toggle_follow" 0 %}'.replace('0', userId),
                    method: 'POST',
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.error) {
                            alert(data.error);
                        } else {
                            if (data.is_following) {
                                $('#toggle-follow').text('Unfollow');
                            } else {
                                $('#toggle-follow').text('Follow');
                            }
                            $('#follower-count').text('Followers: ' + data.follower_count);
                        }
                    }
                });
            });
        });
    </script>

{% endblock %} {% endcomment %}


{% comment %} {% block content %} {% endcomment %}
<style>
  .intro {
      display: flex;
      margin-left: 50px;
      margin-bottom: 50px;
  }
  .profile_img {
      height: 150px;
      width: 150px;
  }
  
  .profile_img img {
    height: auto; /* This will make the height adjust to maintain the aspect ratio */
    width: 150px; /* Set the width as desired */
    border-radius: 50%;
    object-fit: cover; /* This will cover the div with the image without stretching it */
}

  .info,
  .activityDetail,
  .bio {
      margin: 15px 0px 0px 100px;
      display: flex;
  }
  .bio {
      font-weight: bold;
  }
  .activityDetail {
      font-size: 18px;
  }
  .postsNo {
      margin-right: 20px;
  }
  .username {
      margin-right: 20px;
      font-size: 25px;
  }
  .postsAndOthers {
      border-top: 1px solid rgb(189, 188, 188);
  }
  .links {
      margin-top: 10px;
      display: flex;
      font-size: 15px;
      margin-left: 45%;
  }
  .link {
      cursor: pointer;
  }
    .posts {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* creates three columns */
        gap: 5px; /* space between grid items */
        padding: 5px;
        justify-items: center;
    }

    .single_post {
        display: flex;
        justify-content: center; /* centers the image horizontally */
        align-items: center; /* centers the image vertically */
        overflow: hidden; /* hides parts of the image that overflow the container */
        margin-top: 5px;
        height: 300px; /* fixed height */
        width: 305px; /* fixed width */
        background-color: #f4f4f4; /* background color for the empty space around the image if any */
    }

    .single_post img {
        max-height: 100%; /* maximum height is the container height */
        max-width: 100%; /* maximum width is the container width */
        object-fit: cover; /* covers the container with the image without stretching */
    }
</style>
<div class="intro">
  <div class="profile_img">
      <img
          height="150px"
          width="150px"
          style="border-radius: 50%"
          src="{{ profile_data.profile_picture.url }}"
      />
  </div>
  <div class="mainInfo">
      <div class="info">
          <div class="username">{{user_data.username}}</div>
          <div class="buttons">
              {% if user == user_data %}
              <a href="{% url "post_profile:edit_profile_details" user.id %}">
                  <button
                      style="
                          width: 120px;
                          font-weight: bold;
                          padding: 8px;
                          cursor: pointer;
                          border: 0px solid rgb(189, 188, 188);
                          border-radius: 10px;
                          bacground-color: rgb(189, 188, 188);
                          font-size: 15px;
                      "
                  >
                      Edit profile
                  </button>
              </a>
              {% else %}
              {% if follow is none %}
              <a style="text-deacoration: none; color: black" href="{% url 'post_profile:follow' user_data.id %}">
                  <button style="width: 120px; font-weight: bold; padding: 8px; cursor: pointer; border: 0px solid rgb(189, 188, 188); border-radius: 10px; bacground-color: rgb(189, 188, 188); font-size: 15px;">Follow</button>
              </a>
              {% else %}
              <a style="text-deacoration: none; color: black" href="{% url 'post_profile:unfollow' user_data.id %}">
                  <button style="width: 120px; font-weight: bold; padding: 8px; cursor: pointer; border: 0px solid rgb(189, 188, 188); border-radius: 10px; bacground-color: rgb(189, 188, 188); font-size: 15px;">Unfollow</button>
              </a>
              {% endif %}
              {% endif %}
          </div>
      </div>
      <div class="activityDetail">
          <div class="postsNo"><b>{{ post_number }}</b> posts</div>
          <div class="postsNo"><b>{{ follower }}</b> followers</div>
          <div class="postsNo"><b>{{ following }}</b> following</div>
      </div>
      <div class="bio">{{profile_data.bio}}</div>
  </div>
</div>
<div class="postsAndOthers">
  <div class="links">
      <div class="link"><i class="fa-solid fa-table-cells"></i> POSTS</div>
  </div>
  {% if user_data == request.user or follow is not none %}
  <div class="posts">
    {% for post in posts %}
    <div class="single_post">
        <a href="{% url 'post_profile:photo_detail' post.id %}">
            <div class="post_image">
                <img src="{{ post.image.url }}" />
            </div>
        </a>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div style="text-align: center; margin-top: 50px">
      <h2>Please follow to see the post</h2>
  </div>
  {% endif %}
</div>


{% comment %} {% endblock %} {% endcomment %}
